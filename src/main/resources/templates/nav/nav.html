<nav class="nav" th:fragment="navbar">
    <a class="loaCheck" href="/home">LOA Check</a>
    <a href="/homework">숙제</a>
    <a href="/friend">친구</a>
    <a href="/schedule">일정</a>
    <a href="cube">큐브</a>
    <a href="/search">실시간 검색순위</a>

    <div class="login">
        <button id="theme-toggle"><i class="fas fa-moon"></i></button> <!-- 다크 모드 변환 -->
        <div th:if="${#authentication.principal != null and #authentication.principal != 'anonymousUser'}">
            <!-- 로그인된 경우 -->
            <button id="toggle-logout">
                <h4 th:text="${#authentication.principal.username}"></h4>
            </button>
            <div id="logout-container" style="display : none; margin-top : 10px;">
                <a id="logout-link" href="/logout" >로그아웃</a>
            </div>
        </div>

        <div th:if="${#authentication.principal == null or #authentication.principal == 'anonymousUser'}">
            <!-- 로그인되지 않은 경우 -->
            <a href="/login">로그인</a>
        </div>


    </div>
     <script>
         // 테마 색상을 변경
         // 페이지 로드 시 이전에 설정한 테마를 확인하고 적용하기
         document.addEventListener("DOMContentLoaded", function () {
             const theme = localStorage.getItem("theme") || "light";
             document.documentElement.setAttribute("data-theme", theme);
             updateButtonLabel(theme);
         });

             // 버튼 클릭 시 테마 전환하기
         document.getElementById("theme-toggle").addEventListener("click", function () {
             const currentTheme = document.documentElement.getAttribute("data-theme");
             const newTheme = currentTheme === "dark" ? "light" : "dark";

             // 새로운 테마 설정
         document.documentElement.setAttribute("data-theme", newTheme);
             localStorage.setItem("theme", newTheme); // 테마 설정을 localStorage에 저장
             updateButtonLabel(newTheme); // 버튼 라벨 업데이트
         });

             // 버튼 라벨을 테마에 따라 업데이트
         function updateButtonLabel(theme) {
             const button = document.getElementById("theme-toggle");
             if(theme === "dark"){
                button.innerHTML = '<i class="fa-solid fa-moon fa-2x"></i>';
                }
             else{
                button.innerHTML = '<i class="fa-regular fa-sun fa-2x"></i>';
             }
         }
     </script>
    <script>
        // 로그인했을때 로그아웃 클릭했을 때 나타나게끔
        // DOMContentLoaded 를 사용해서 html 다 업로드된후 사용
        document.addEventListener("DOMContentLoaded" , function(){
            const toggleButton = document.getElementById("toggle-logout");
            const logoutContainer = document.getElementById("logout-container");

            toggleButton.addEventListener("click", function() {
                if(logoutContainer.style.display === "none"){
                    logoutContainer.style.display = "block";
                    console.log("버튼 클릭됨");
                    console.log("현재 로그아웃 상태:", logoutContainer.style.display);
                }
                else{
                    logoutContainer.style.display = "none";
                }
            });
        });
    </script>
</nav>